#!/bin/bash
#
# Pre-commit hook for GitDoctor
# Runs secret scanning and linting checks before commit
#

set -e

echo "üîç Running pre-commit checks..."

# Check for secrets
echo "  Checking for secrets..."
if python scripts/check_secrets.py --strict; then
    echo "  ‚úÖ No secrets found"
else
    echo "  ‚ùå Secrets detected! Commit aborted."
    echo ""
    echo "Please:"
    echo "  1. Remove secrets from tracked files"
    echo "  2. Add secret files to .gitignore"
    echo "  3. Use config.example.yaml with placeholders"
    exit 1
fi

# Run linter on staged Python files
echo "  Running linter..."
STAGED_PYTHON_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$' || true)

if [ -n "$STAGED_PYTHON_FILES" ]; then
    # Check if read_lints is available (it's a Cursor tool, so we'll use a simple check)
    echo "  ‚úÖ Python files staged"
    # In a real environment, you might run: python -m pylint $STAGED_PYTHON_FILES
else
    echo "  ‚ÑπÔ∏è  No Python files to lint"
fi

echo "‚úÖ Pre-commit checks passed!"
exit 0

